export default{version:"1.7.5",_base64KeyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_testNumber:0,isBrowserEnvironment:function(){return"object"==typeof window&&"object"==typeof document},browserStorageAvailable:function(e,n){if(!this.isBrowserEnvironment())return!1;let s,t,i=!1;void 0!==e&&null!=e&&""!=e||(e="localStorage");try{i=e in window&&null!==window[e],i&&n&&(s=window[e],t="commonUtilities",s.setItem(t,"1"),s.removeItem(t))}catch(e){i=!1}return i},booleanToString:function(e){return e?"true":"false"},objectToString:function(e){var n,s;if(e)for(s in n="",e)e.hasOwnProperty(s)&&(n+=(n.length>0?" ":"")+s+": "+e[s]+";");else n="null;";return n},arrayToString:function(e){var n,s,t;if(e&&e instanceof Array){for(s in n="[",e)void 0===(t=e[s])?t="undefined":Array.isArray(t)?t=this.arrayToString(t):"object"==typeof t&&(t=this.objectStringify(t)),n+=(n.length>1?", ":"")+s+": "+t;n+="]"}else n="null";return n},objectStringify:function(e){var n,s=[];if(null==e)return String(e);if("function"==typeof e)s.push(e.toString());else{if("object"==typeof e){if(void 0===e.join){for(n in e)e.hasOwnProperty(n)&&s.push(n+": "+this.objectStringify(e[n]));return"{"+s.join(", ")+"}"}for(n in e)s.push(this.objectStringify(e[n]));return"["+s.join(", ")+"]"}s.push(JSON.stringify(e))}return s.join(", ")},queryStringToObject:function(e){const n=/([^&=]+)=?([^&]*)/g;let s,t={};function i(e){return decodeURIComponent(e.replace(/\+/g," "))}for(e?"?"==e[0]&&(e=e.substring(1)):window&&(e=window.location.search.substring(1));s=n.exec(e);)t[i(s[1])]=i(s[2]);return t},appendQueryParametersToURL:function(e,n){var s=e.indexOf("?"),t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(n[i]));return s>0&&s<e.length-1?e+="&":-1==s&&(e+="?"),e+=t.join("&")},extendObject:function(){var e,n,s,t,i,r,o;if(arguments.length>0){if(s=arguments[0],arguments.length>1)for(r=0,o=(i=arguments.slice(1)).length;r<o;r++)for(e in t=i[r])n=t[e],s[e]=n}else s={};return s},matchInArray:function(e,n){var s,t=0;if(e&&n&&n.constructor===Array)for(s=n.length;t<s;t++)if(e.match(n[t]))return t;return-1},arrayCount:function(e){return e.reduce(function(e,n){return e[n]=(e[n]||0)+1,e},{})},makeFullPath:function(e){return e?("/"!==e[e.length-1]&&(e+="/"),"/"!==e[0]&&(e="/"+e)):e="/",e},appendFileToPath:function(e,n){return e&&n?"/"!==e[e.length-1]&&"/"!==n[0]?e+="/"+n:"/"==e[e.length-1]&&"/"==n[0]?e+=n.substring(1):e+=n:n&&(e=n),e},tokenReplace:function(e,n){var s,t;for(s in n)n.hasOwnProperty(s)&&(t=new RegExp("{"+s+"}","g"),e=e.replace(t,n[s]));return e},stringTranslate:function(e,n,s){var t,i,r,o,a="";if("string"!=typeof e||e.length<1||!Array.isArray(n)||!Array.isArray(s)||n.length!=s.length)return e;for(o=e.length,t=0;t<o;t++)i=e.charAt(t),(r=n.indexOf(i))>=0&&(i=s[r]),a+=i;return a},isEmpty:function(e){return null==e||!1===e||"string"==typeof e&&(""===e||"null"===e||"NULL"===e)||e instanceof Array&&0==e.length||"number"==typeof e&&(isNaN(e)||0===e)},isNull:function(e){return null==e},coerceBoolean:function(e){return"string"==typeof e?"1"===(e=e.toLowerCase())||"true"===e||"t"===e||"checked"===e||"yes"===e||"y"===e:!0===e||1===e},coalesceNotEmpty:function(...e){const n=this;if(e&&!(e.length<1))return e.find(function(e){return!n.isEmpty(e)})},coalesceNotNull:function(...e){const n=this;if(e&&!(e.length<1))return e.find(function(e){return!n.isNull(e)})},safeForHTML:function(e){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return(""+e).replace(/[&<>"'\/]/g,function(e){return n[e]})},makeSafeForId:function(e){return"string"!=typeof e&&(e=null!=e?e.toString():"id"),(e=e.trim()).length>0?e.replace(/-/g," ").replace(/[^\w\s]/g,"").replace(/\s\s+/g," ").replace(/\s/g,"-").toLowerCase().substr(0,50):"id"},isTouchDevice:function(){return!(!window||!("ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch))},isMobile:function(){return this.isMobileAndroid()||this.isMobileIos()},isMobileAndroid:function(){return!(!navigator||!navigator.userAgent.match(/Android/i))},isMobileIos:function(){return!(!navigator||!navigator.userAgent.match(/iPhone|iPad|iPod/i))},unlockWebAudio:function(){var e=document.createElement("audio");return e.controls=!1,e.preload="auto",e.loop=!1,e.src="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAADAAAGhgBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr///////////////////////////////////////////8AAAA5TEFNRTMuOThyAc0AAAAAAAAAABSAJAiqQgAAgAAABobxtI73AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxAACFEII9ACZ/sJZwWEoEb8w/////N//////JcxjHjf+7/v/H2PzCCFAiDtGeyBCIx7bJJ1mmEEMy6g8mm2c8nrGABB4h2Mkmn//4z/73u773R5qHHu/j/w7Kxkzh5lWRWdsifCkNAnY9Zc1HvDAhjhSHdFkHFzLmabt/AQxSg2wwzLhHIJOBnAWwVY4zrhIYhhc2kvhYDfQ4hDi2Gmh5KyFn8EcGIrHAngNgIwVIEMf5bzbAiTRoAD///8z/KVhkkWEle6IX+d/z4fvH3BShK1e5kmjkCMoxVmXhd4ROlTKo3iipasvTilY21q19ta30/v/0/idPX1v8PNxJL6ramnOVsdvMv2akO0iSYIzdJFirtzWXCZicS9vHqvSKyqm5XJBdqBwPxyfJdykhWTZ0G0ZyTZGpLKxsNwwoRhsx3tZfhwmeOBVISm3impAC/IT/8hP/EKEM1KMdVdVKM2rHV4x7HVXZvbVVKN/qq8CiV9VL9jjH/6l6qf7MBCjZmOqsAibjcP+qqqv0oxqpa/NVW286hPo1nz2L/h8+jXt//uSxCmDU2IK/ECN98KKtE5IYzNoCfbw+u9i5r8PoadUMFPKqWL4LK3T/LCraMSHGkW4bpLXR/E6LlHOVQxmslKVJ8IULktMN06N0FKCpHCoYsjC4F+Z0NVqdNFoGSTjSiyjzLdnZ2fNqTi2eHKONONKLMPMKLONKLMPQRJGlFxZRoKcJFAYEeIFiRQkUWUeYfef//Ko04soswso40UJAgMw8wosososy0EalnZyjQUGBRQGIFggOWUacWUeYmuadrZziQKKEgQsQLAhQkUJAgMQDghltLO1onp0cpkNInSFMqlYeSEJ5AHsqFdOwy1DA2sRmRJKxdKRfLhfLw5BzUxBTUUzLjk4LjJVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk4LjJVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksRRA8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",document.addEventListener("visibilitychange",function(){"visible"==document.visibilityState&&e.play()}),e},utf8Encode:function(e){var n,s,t="",i=e.length;for(e=e.replace(/\r\n/g,"\n"),n=0;n<i;n++)(s=e.charCodeAt(n))<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128));return t},utf8Decode:function(e){for(var n,s,t,i="",r=e.length,o=0;o<r;)(n=e.charCodeAt(o))<128?(i+=String.fromCharCode(n),o++):n>191&&n<224?(s=e.charCodeAt(o+1),i+=String.fromCharCode((31&n)<<6|63&s),o+=2):(s=e.charCodeAt(o+1),t=e.charCodeAt(o+2),i+=String.fromCharCode((15&n)<<12|(63&s)<<6|63&t),o+=3);return i},base64FromImageUrl:function(e,n){var s=new Image;s.src=e,s.onload=function(){var e,s=document.createElement("canvas"),t=s.getContext("2d");s.width=this.width,s.height=this.height,t.drawImage(this,0,0),e=s.toDataURL("image/png"),n(e)},s.onerror=function(){n(null)}},base64Encode:function(e){let n,s,t,i,r,o,a,u="",c=0;const d=(e=this.utf8Encode(e)).length;for(;c<d;)n=e.charCodeAt(c++),s=e.charCodeAt(c++),t=e.charCodeAt(c++),i=n>>2,r=(3&n)<<4|s>>4,o=(15&s)<<2|t>>6,a=63&t,isNaN(s)?o=a=64:isNaN(t)&&(a=64),u=u+this._base64KeyStr.charAt(i)+this._base64KeyStr.charAt(r)+this._base64KeyStr.charAt(o)+this._base64KeyStr.charAt(a);return u},base64Decode:function(e){let n,s,t,i,r,o,a,u="",c=0;const d=(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length;for(;c<d;)i=this._base64KeyStr.indexOf(e.charAt(c++)),r=this._base64KeyStr.indexOf(e.charAt(c++)),o=this._base64KeyStr.indexOf(e.charAt(c++)),a=this._base64KeyStr.indexOf(e.charAt(c++)),n=i<<2|r>>4,s=(15&r)<<4|o>>2,t=(3&o)<<6|a,u+=String.fromCharCode(n),64!=o&&(u+=String.fromCharCode(s)),64!=a&&(u+=String.fromCharCode(t));return this.utf8Decode(u)},base64URLEncode:function(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"~")},base64URLDecode:function(e){return e.replace(/\-/g,"+").replace(/\_/g,"/").replace(/\~/g,"=")},arrayBufferToBase64:function(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e)))},base64ToArrayBuffer:function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},hexStringToByteArray:function(e){const n=e.length;if(n%2==1)return null;if(e.match(/[^0-9A-Fa-f]/))return null;let s=[],t=0;for(;t<n;t+=2)s.push(parseInt(e.substring(t,t+2),16));return new Uint8Array(s)},stringToByteArray:function(e){return(new TextEncoder).encode(e)},byteArrayToString:function(e){return(new TextDecoder).decode(e)},byteArrayToHexString:function(e){if(!ArrayBuffer.isView(e)&&!Array.isArray(e))return"";const n=e.length,s=new Uint8Array(2*n),t="a".charCodeAt(0)-10,i="0".charCodeAt(0);let r,o=0;for(let a=0;a<n;a+=1)r=e[a]>>>4,s[o++]=r>9?r+t:r+i,r=15&e[a],s[o++]=r>9?r+t:r+i;return String.fromCharCode.apply(null,s)},roundTo:function(e,n){const s=Math.pow(10,n);return Math.round(e*s)/s},cookieGet:function(e){return this.isBrowserEnvironment()&&e&&document.cookie&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},cookieSet:function(e,n,s,t,i,r){if(!this.isBrowserEnvironment())return null;let o,a,u;if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;if(null==n)return this.cookieRemove(e,t,i);if(o="",a="expires=Fri, 31 Dec 9999 23:59:59 GMT",u="samesite=lax",void 0===r&&(r=!0),"object"==typeof n&&(n=JSON.stringify(n)),s)switch(s.constructor){case Number:o=s===1/0?a:"; max-age="+s;break;case String:o="expires="+s;break;case Date:o="expires="+s.toUTCString();break;default:o=a}else o=a;const c=encodeURIComponent(n)+"; "+o+(i?";domain="+i:"")+(t?";path="+t:"")+";samesite=lax"+(r?";Secure":"");return"undefined"==typeof document||void 0===document.cookie?c:(document.cookie=encodeURIComponent(e)+"="+c,!0)},cookieRemove:function(e,n,s){return!!this.cookieExists(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(s?"; domain="+s:"")+(n?"; path="+n:""),!0)},cookieExists:function(e){return!!this.isBrowserEnvironment()&&(!(!e||!document.cookie)&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie))},cookieGetKeys:function(){if(!this.isBrowserEnvironment())return[];for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),n=e.length,s=0;s<n;s++)e[s]=decodeURIComponent(e[s]);return e},haveSessionStorage:function(){return this.browserStorageAvailable("sessionStorage",!0)},haveLocalStorage:function(){return this.browserStorageAvailable("localStorage",!0)},storageGet:function(e,n){if(!this.isBrowserEnvironment())return null;let s,t;return void 0!==n&&null!=n||(n=window.localStorage),s=n.getItem(e),null!=s?(t=JSON.parse(s),null==t&&(t=s)):t=null,t},saveObjectWithKey:function(e,n){var s,t,i=!1;if(this.browserStorageAvailable("localStorage",!1)&&null!=e)try{s=window.localStorage,null!=n?(t="object"==typeof n?JSON.stringify(n):n.toString(),s.setItem(e,t)):s.removeItem(e),i=!0}catch(e){i=!1}return i},loadObjectWithKey:function(e){var n,s=null;if(this.browserStorageAvailable("localStorage",!1)&&null!=e)try{null!=(n=window.localStorage[e])&&(s="{"==n[0]||"]"==n[0]?JSON.parse(n):n)}catch(e){s=null}return s},removeObjectWithKey:function(e){var n=!1;if(this.browserStorageAvailable("localStorage",!1)&&null!=e)try{window.localStorage.removeItem(e),n=!0}catch(e){n=!1}return n},shareOnFacebook:function(e,n){let s=encodeURIComponent(n);e&&""!=e&&(s+="&quote="+encodeURIComponent(e)),window.open("https://www.facebook.com/sharer/sharer.php?u="+s,"_share","toolbar=no,status=0,width=626,height=436")},shareOnTwitter:function(e,n,s,t){let i="text="+encodeURIComponent(e);n&&""!=n&&(i+="&url="+encodeURIComponent(n)),s&&""!=s&&(i+="&related="+s),t&&""!=t&&(i+="&hashtags="+t),window.open("https://twitter.com/intent/tweet?"+i,"_share","toolbar=no,status=0,width=626,height=436")},shareOnBsky:function(e,n,s){let t="text="+encodeURIComponent(e);n&&""!=n&&!e.includes(n.toLowerCase())&&(t+=" "+encodeURIComponent(n)),s&&""!=s&&(t+=" "+encodeURIComponent(s)),window.open("https://bsky.app/intent/compose?"+t,"_share","toolbar=no,status=0,width=626,height=436")},shareByEmail:function(e,n,s){let t;t=s&&""!=s?n+"\n\n"+s:n,window.open("mailto:?subject="+encodeURIComponent(e)+"&body="+encodeURIComponent(t),"_share","popup=1,toolbar=no,status=0,noopener=1,noreferrer=1,width=626,height=436")},shareBySMS:function(e,n){let s;s=n&&""!=n?e+": "+n:e,window.open("sms:?&body="+encodeURIComponent(s),"_share","popup=1,toolbar=no,status=0,noopener=1,noreferrer=1,width=626,height=436")},performanceTest:function(e,n,s){if(!this.isBrowserEnvironment())return null;let t,i,r,o;if(window.performance){for(this._testNumber++,t=window.performance.now(),r=0;r<s;r++)e();i=window.performance.now()-t,o={testNumber:this._testNumber,testFunction:n,duration:i,durationUnits:"ms",totalIterations:r}}else o=null;return o},simpleVersionCompare:function(e,n){const s=e.split("."),t=n.split(".");let i,r,o=0;s.length>t.length?(i=t,r=s):(i=s,r=t);for(let e=0;e<i.length;e+=1){const n=parseInt(i[e]),s=parseInt(r[e]);if(n<s){o=1;break}if(n>s){o=-1;break}}return o},MySQLDate:function(e){let n;return n=null==e||null==e?new Date:e instanceof Date?e:new Date(e),n.toISOString().slice(0,10)},subtractYearsFromNow:function(e){var n=new Date;return n.setFullYear(n.getFullYear()-e),n},insertScriptElement:function(e,n,s,t){if(!document||document.getElementById(e))return!1;this.isEmpty(s)&&(s="body"),this.isEmpty(t)&&(t="text/javascript");let i=document.getElementsByTagName(s)[0];null==i&&(i=document.getElementsByTagName("div")[0]);const r=document.createElement("script");return r.id=e,r.src=n,r.type=t,r.async=!0,i.appendChild(r),!0},tagParse:function(e,n){let s,t;if(null==e||e.length<1)s=[];else for(null!=n&&""!=n||(n=";"),s=e.split(n),t=s.length-1;t>=0;t--)s[t]=this.stripTags(s[t],"").substring(0,50).trim(),s[t].length<1&&s.splice(t,1);return s},stripTags:function(e,n){if(this.isNull(e))return"";if("string"!=typeof e&&(e=e.toString()),this.isEmpty(e))return"";n=(((n||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,s){return n.indexOf("<"+s.toLowerCase()+">")>-1?e:""})},isValidEmail:function(e){return/\S+@\S+\.\S+/.test(e)},validateFields:function(e,n){var s,t,i,r,o,a,u=[];if(null!=e&&null!=n)for(s in n)if(n.hasOwnProperty(s))if(t=n[s],i=e[s],t.hasOwnProperty("optional")||(t.optional=!1),!t.optional&&this.isEmpty(i))u[s]={code:"required",message:"This field is required."};else if(t.hasOwnProperty("validator"))t.validator(s,i)||(u[s]={code:"validator",message:"This field failed validation."});else if(!t.optional||!this.isEmpty(i))switch(t.hasOwnProperty("type")||(t.type="string"),t.hasOwnProperty("min")||(t.min="number"==t.type?Number.MIN_SAFE_INTEGER:0),t.hasOwnProperty("max")||(t.max=Number.MAX_SAFE_INTEGER),o=t.hasOwnProperty("options")?t.options:[],t.type){case"string":i.length<t.min?u[s]={code:"min",message:"The field length is less than the minimum number of characters."}:i.length>t.max?u[s]={code:"max",message:"The field length is more than the maximum number of characters."}:o.length>0&&o.indexOf(i)<0&&(u[s]={code:"options",message:"The field value is not an option."});break;case"number":i<t.min?u[s]={code:"min",message:"The field is less than the minimum value allowed."}:i>t.max?u[s]={code:"max",message:"The field is more than the maximum value allowed."}:o.length>0&&o.indexOf(i)<0&&(u[s]={code:"options",message:"The field value is not an option."});break;case"bool":case"boolean":o.length>0&&o.indexOf(i)<0&&(u[s]={code:"options",message:"The field value is not an option."});break;case"date":i instanceof Date&&((r=i.getTime())<t.min?u[s]={code:"min",message:"The date field is before the minimum date allowed."}:r>t.max?u[s]={code:"max",message:"The date field is after the maximum date allowed."}:o.length>0&&o.indexOf(r)<0&&(u[s]={code:"options",message:"The field value is not a valid option."}));break;case"array":if(i.length<t.min)u[s]={code:"min",message:"The field contains less than the minimum number of items."};else if(i.length>t.max)u[s]={code:"max",message:"The field contains more than the maximum number of items."};else if(o.length>0)for(a=0;a<i.length;a++)if(o.indexOf(i[a])<0){u[s]={code:"options",message:"A field value is not a valid option."};break}break;case"email":this.isEmpty(i)||this.isValidEmail(i)||(u[s]={code:"invalid",message:"The email address is not valid."})}return u},domainDropServer:function(e){var n=e?e.toString():"",s=n.indexOf("://");s>0&&(n=n.substring(s+3)),0==(s=n.indexOf("//"))&&(n=n.substring(2)),(s=n.indexOf("/"))>0&&(n=n.substring(0,s)),(s=n.indexOf(":"))>0&&(n=n.substring(0,s));var t=n.split(".");return t.length>2&&t.shift(),n=t.join(".")},encryptString:async function(e,n,s){const t=this;return new Promise(function(i,r){const o="AES-CBC";crypto.subtle.importKey("raw",t.stringToByteArray(n),{name:o},!0,["encrypt","decrypt"]).then(function(n){const a=new TextEncoder;crypto.subtle.encrypt({name:o,iv:s},n,a.encode(e)).then(function(e){i(t.arrayBufferToBase64(e))}).catch(function(e){r(e)})}).catch(function(e){r(e)})})},decryptString:async function(e,n,s){const t=this;return new Promise(function(i,r){const o="AES-CBC";crypto.subtle.importKey("raw",t.stringToByteArray(n),{name:o},!0,["encrypt","decrypt"]).then(function(n){crypto.subtle.decrypt({name:o,iv:s},n,t.base64ToArrayBuffer(e)).then(function(e){const n=(new TextDecoder).decode(e);i(n)}).catch(function(e){r(e)})}).catch(function(e){r(e)})})},md5:function(e){function n(e,n){return e<<n|e>>>32-n}function s(e,n){var s,t,i,r,o;return i=2147483648&e,r=2147483648&n,o=(1073741823&e)+(1073741823&n),(s=1073741824&e)&(t=1073741824&n)?2147483648^o^i^r:s|t?1073741824&o?3221225472^o^i^r:1073741824^o^i^r:o^i^r}function t(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return e&n|~e&s}(t,i,r),o),u)),s(n(e,a),t)}function i(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return e&s|n&~s}(t,i,r),o),u)),s(n(e,a),t)}function r(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return e^n^s}(t,i,r),o),u)),s(n(e,a),t)}function o(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return n^(e|~s)}(t,i,r),o),u)),s(n(e,a),t)}function a(e){var n,s="",t="";for(n=0;n<=3;n++)s+=(t="0"+(e>>>8*n&255).toString(16)).substr(t.length-2,2);return s}var u,c,d,g,l,f,m,V,h,p;for(u=function(e){for(var n,s=e.length,t=s+8,i=16*((t-t%64)/64+1),r=Array(i-1),o=0,a=0;a<s;)o=a%4*8,r[n=(a-a%4)/4]=r[n]|e.charCodeAt(a)<<o,a++;return o=a%4*8,r[n=(a-a%4)/4]=r[n]|128<<o,r[i-2]=s<<3,r[i-1]=s>>>29,r}(e=function(e){e=e.replace(/rn/g,"n");for(var n="",s=0;s<e.length;s++){var t=e.charCodeAt(s);t<128?n+=String.fromCharCode(t):t>127&&t<2048?(n+=String.fromCharCode(t>>6|192),n+=String.fromCharCode(63&t|128)):(n+=String.fromCharCode(t>>12|224),n+=String.fromCharCode(t>>6&63|128),n+=String.fromCharCode(63&t|128))}return n}(e)),m=1732584193,V=4023233417,h=2562383102,p=271733878,c=0;c<u.length;c+=16)d=m,g=V,l=h,f=p,m=t(m,V,h,p,u[c+0],7,3614090360),p=t(p,m,V,h,u[c+1],12,3905402710),h=t(h,p,m,V,u[c+2],17,606105819),V=t(V,h,p,m,u[c+3],22,3250441966),m=t(m,V,h,p,u[c+4],7,4118548399),p=t(p,m,V,h,u[c+5],12,1200080426),h=t(h,p,m,V,u[c+6],17,2821735955),V=t(V,h,p,m,u[c+7],22,4249261313),m=t(m,V,h,p,u[c+8],7,1770035416),p=t(p,m,V,h,u[c+9],12,2336552879),h=t(h,p,m,V,u[c+10],17,4294925233),V=t(V,h,p,m,u[c+11],22,2304563134),m=t(m,V,h,p,u[c+12],7,1804603682),p=t(p,m,V,h,u[c+13],12,4254626195),h=t(h,p,m,V,u[c+14],17,2792965006),m=i(m,V=t(V,h,p,m,u[c+15],22,1236535329),h,p,u[c+1],5,4129170786),p=i(p,m,V,h,u[c+6],9,3225465664),h=i(h,p,m,V,u[c+11],14,643717713),V=i(V,h,p,m,u[c+0],20,3921069994),m=i(m,V,h,p,u[c+5],5,3593408605),p=i(p,m,V,h,u[c+10],9,38016083),h=i(h,p,m,V,u[c+15],14,3634488961),V=i(V,h,p,m,u[c+4],20,3889429448),m=i(m,V,h,p,u[c+9],5,568446438),p=i(p,m,V,h,u[c+14],9,3275163606),h=i(h,p,m,V,u[c+3],14,4107603335),V=i(V,h,p,m,u[c+8],20,1163531501),m=i(m,V,h,p,u[c+13],5,2850285829),p=i(p,m,V,h,u[c+2],9,4243563512),h=i(h,p,m,V,u[c+7],14,1735328473),m=r(m,V=i(V,h,p,m,u[c+12],20,2368359562),h,p,u[c+5],4,4294588738),p=r(p,m,V,h,u[c+8],11,2272392833),h=r(h,p,m,V,u[c+11],16,1839030562),V=r(V,h,p,m,u[c+14],23,4259657740),m=r(m,V,h,p,u[c+1],4,2763975236),p=r(p,m,V,h,u[c+4],11,1272893353),h=r(h,p,m,V,u[c+7],16,4139469664),V=r(V,h,p,m,u[c+10],23,3200236656),m=r(m,V,h,p,u[c+13],4,681279174),p=r(p,m,V,h,u[c+0],11,3936430074),h=r(h,p,m,V,u[c+3],16,3572445317),V=r(V,h,p,m,u[c+6],23,76029189),m=r(m,V,h,p,u[c+9],4,3654602809),p=r(p,m,V,h,u[c+12],11,3873151461),h=r(h,p,m,V,u[c+15],16,530742520),m=o(m,V=r(V,h,p,m,u[c+2],23,3299628645),h,p,u[c+0],6,4096336452),p=o(p,m,V,h,u[c+7],10,1126891415),h=o(h,p,m,V,u[c+14],15,2878612391),V=o(V,h,p,m,u[c+5],21,4237533241),m=o(m,V,h,p,u[c+12],6,1700485571),p=o(p,m,V,h,u[c+3],10,2399980690),h=o(h,p,m,V,u[c+10],15,4293915773),V=o(V,h,p,m,u[c+1],21,2240044497),m=o(m,V,h,p,u[c+8],6,1873313359),p=o(p,m,V,h,u[c+15],10,4264355552),h=o(h,p,m,V,u[c+6],15,2734768916),V=o(V,h,p,m,u[c+13],21,1309151649),m=o(m,V,h,p,u[c+4],6,4149444226),p=o(p,m,V,h,u[c+11],10,3174756917),h=o(h,p,m,V,u[c+2],15,718787259),V=o(V,h,p,m,u[c+9],21,3951481745),m=s(m,d),V=s(V,g),h=s(h,l),p=s(p,f);return(a(m)+a(V)+a(h)+a(p)).toLowerCase()},getGravatarURL:function(e,n){n=n||80;return"https://www.gravatar.com/avatar/"+this.md5(e)+".jpg?s="+n}};const enginesis={VERSION:"2.12.5",debugging:!0,disabled:!1,isOnline:!0,isPaused:!1,errorLevel:15,useHTTPS:!0,serverStage:null,serverHost:null,siteResources:{serviceURL:null,avatarImageURL:null,assetUploadURL:null},siteId:0,gameId:0,gameKey:"",gameGroupId:0,languageCode:"en",internalStateSeq:0,lastResponse:null,callBackFunction:null,authToken:null,authTokenWasValidated:!1,authTokenExpires:null,refreshToken:null,refreshTokenExpires:null,sessionId:null,sessionExpires:null,developerKey:null,loggedInUserInfo:{},networkId:1,platform:"",locale:"en-US",isUserLoggedIn:!1,isNativeBuild:!1,isBrowserBuild:"undefined"!=typeof window&&null!==window&&void 0!==window.document&&void 0!==window.location,isNodeBuild:"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,isTouchDeviceFlag:!1,SESSION_COOKIE:"engsession",SESSION_USERINFO:"engsession_user",refreshTokenStorageKey:"engrefreshtoken",captchaId:"99999",captchaResponse:"DEADMAN",anonymousUserKey:"enginesisAnonymousUser",anonymousUser:null,serviceQueue:[],serviceQueueSaveKey:"enginesisServiceQueue",serviceQueueRestored:0,assetUploadQueue:null,nodeRequest:null,gameInfo:null,favoriteGames:new Set,favoriteGamesNextCheck:0,supportedNetworks:{Enginesis:1,Facebook:2,Google:7,Twitter:11,Apple:14,bsky:15}};let enginesisContext=null;function debugLog(e,n){enginesis.debugging&&(null==n&&(n=15),(enginesis.errorLevel&n)>0&&console.log(e),9==n&&alert(e))}function isValidOperationalState(){return enginesis.siteId>0&&enginesis.developerKey.length>0&&enginesis.siteResources.serviceURL.length>0}function isEmpty(e){return null==e||!1===e||"string"==typeof e&&(""===e||"undefined"===e)||Array.isArray(e)&&0==e.length||"number"==typeof e&&(isNaN(e)||0===e)}function isNull(e){return null==e}function coerceBoolean(e){return"string"==typeof e?"1"===(e=e.toLowerCase())||"true"===e||"t"===e||"checked"===e||"yes"===e||"y"===e:!0===e||1===e}function coerceNotEmpty(){const e=arguments.length;let n;if(0==e)n=null;else if(1==e)n=arguments[0];else{for(let s=0;s<e;s+=1)if(!isEmpty(arguments[s])){n=arguments[s];break}void 0===n&&(n=arguments[e-1])}return n}function coerceNotNull(){const e=arguments.length;let n;if(0==e)n=null;else if(1==e)n=arguments[0];else{for(let s=0;s<e;s+=1)if(!isNull(arguments[s])){n=arguments[s];break}void 0===n&&(n=arguments[e-1])}return n}function validGender(e){let n;return isEmpty(e)?n="N":(n=e.trim().toUpperCase(),n="M"==n[0]?"M":"F"==n[0]?"F":"N"),n}function saveObjectWithKey(e,n){null!=e&&null!=n&&"undefined"!=typeof window&&void 0!==window.localStorage&&(window.localStorage[e]=JSON.stringify(n))}function removeObjectWithKey(e){null!=e&&"undefined"!=typeof window&&void 0!==window.localStorage&&window.localStorage.removeItem(e)}function loadObjectWithKey(e){let n=null;if(null!=e&&"undefined"!=typeof window&&void 0!==window.localStorage){const s=window.localStorage[e];null!=s&&(n=JSON.parse(s))}return n}function resultIsSuccess(e){return e&&e.results&&e.results.status&&"1"==e.results.status.success}function resultIsExpiredToken(e){return e&&e.results&&e.results.status&&"0"==e.results.status.success&&"TOKEN_EXPIRED"==e.results.status.message}function refreshTokenAndReissueRequest(e){return new Promise(function(n){null!==_getRefreshToken()?enginesisContext.sessionRefresh(_getRefreshToken(),null).then(function(s){sendRequest(e.results.passthru.fn,e.results.passthru,null).then(function(e){n(e)},function(s){debugLog("refreshTokenAndReissueRequest refresh error "+s.toString()),n(e)}).catch(function(s){debugLog("refreshTokenAndReissueRequest refresh exception "+s.toString()),n(e)})},function(s){debugLog("refreshTokenAndReissueRequest refresh error "+s.toString()),n(e)}).catch(function(s){debugLog("refreshTokenAndReissueRequest refresh exception "+s.toString()),n(e)}):n(e)})}function resultErrorCode(e){return e&&e.results&&e.results.status?e.results.status.message:"INVALID_PARAMETER"}function makeErrorResponse(e,n,s){const t={state_seq:0,fn:"unknown",...s};return{fn:t.fn,results:{passthru:t,result:[],status:{success:""==e||"NO_ERROR"==e?"1":"0",message:e,extended_info:n}}}}function serviceRequestComplete(e,n,s){let t;removeFromServiceQueue(e);try{t="string"==typeof n?JSON.parse(n):n}catch(s){t=forceErrorResponseObject("unknown",e,"SERVICE_ERROR","Error: "+s.message+"; "+n.toString(),{}),debugLog("Enginesis requestComplete exception "+JSON.stringify(t))}t.fn=t.results.passthru.fn,enginesis.lastResponse=t,"function"==typeof s?s(t):"function"==typeof enginesis.callBackFunction&&enginesis.callBackFunction(t)}function preprocessEnginesisResult(e){return new Promise(function(n){const s=e.fn;if(resultIsExpiredToken(e))refreshTokenAndReissueRequest(e).then(function(e){n(e)});else if(resultIsSuccess(e)&&s){const n={SessionBegin:updateGameSessionInfo,SessionRefresh:refreshSessionInfo,UserLogin:updateLoggedInUserInfo,UserLogout:clearLoggedInUserInfo,GameGet:updateGameInfo,UserFavoriteGamesList:updateFavoriteGames,UserFavoriteGamesAssign:updateFavoriteGames,UserFavoriteGamesAssignList:updateFavoriteGames,UserFavoriteGamesUnassign:updateFavoriteGames,UserFavoriteGamesUnassignList:updateFavoriteGames}[s];isNull(n)||n(e)}n(e)})}function arrayBufferToBase64(e){return window.btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}function base64ToArrayBuffer(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}function base64URLEncode(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"~")}function base64URLDecode(e){return e.replace(/-/g,"+").replace(/_/g,"/").replace(/~/g,"=")}function stringToByteArray(e){return(new TextEncoder).encode(e)}function md5(e){function n(e,n){return e<<n|e>>>32-n}function s(e,n){var s,t,i,r,o;return i=2147483648&e,r=2147483648&n,o=(1073741823&e)+(1073741823&n),(s=1073741824&e)&(t=1073741824&n)?2147483648^o^i^r:s|t?1073741824&o?3221225472^o^i^r:1073741824^o^i^r:o^i^r}function t(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return e&n|~e&s}(t,i,r),o),u)),s(n(e,a),t)}function i(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return e&s|n&~s}(t,i,r),o),u)),s(n(e,a),t)}function r(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return e^n^s}(t,i,r),o),u)),s(n(e,a),t)}function o(e,t,i,r,o,a,u){return e=s(e,s(s(function(e,n,s){return n^(e|~s)}(t,i,r),o),u)),s(n(e,a),t)}function a(e){var n,s="",t="";for(n=0;n<=3;n++)s+=(t="0"+(e>>>8*n&255).toString(16)).substring(t.length-2);return s}var u,c,d,g,l,f,m,V,h,p;for(u=function(e){for(var n,s=e.length,t=s+8,i=16*((t-t%64)/64+1),r=Array(i-1),o=0,a=0;a<s;)o=a%4*8,r[n=(a-a%4)/4]=r[n]|e.charCodeAt(a)<<o,a++;return o=a%4*8,r[n=(a-a%4)/4]=r[n]|128<<o,r[i-2]=s<<3,r[i-1]=s>>>29,r}(e=function(e){e=e.replace(/rn/g,"n");for(var n="",s=0;s<e.length;s++){var t=e.charCodeAt(s);t<128?n+=String.fromCharCode(t):t>127&&t<2048?(n+=String.fromCharCode(t>>6|192),n+=String.fromCharCode(63&t|128)):(n+=String.fromCharCode(t>>12|224),n+=String.fromCharCode(t>>6&63|128),n+=String.fromCharCode(63&t|128))}return n}(e)),m=1732584193,V=4023233417,h=2562383102,p=271733878,c=0;c<u.length;c+=16)d=m,g=V,l=h,f=p,m=t(m,V,h,p,u[c+0],7,3614090360),p=t(p,m,V,h,u[c+1],12,3905402710),h=t(h,p,m,V,u[c+2],17,606105819),V=t(V,h,p,m,u[c+3],22,3250441966),m=t(m,V,h,p,u[c+4],7,4118548399),p=t(p,m,V,h,u[c+5],12,1200080426),h=t(h,p,m,V,u[c+6],17,2821735955),V=t(V,h,p,m,u[c+7],22,4249261313),m=t(m,V,h,p,u[c+8],7,1770035416),p=t(p,m,V,h,u[c+9],12,2336552879),h=t(h,p,m,V,u[c+10],17,4294925233),V=t(V,h,p,m,u[c+11],22,2304563134),m=t(m,V,h,p,u[c+12],7,1804603682),p=t(p,m,V,h,u[c+13],12,4254626195),h=t(h,p,m,V,u[c+14],17,2792965006),m=i(m,V=t(V,h,p,m,u[c+15],22,1236535329),h,p,u[c+1],5,4129170786),p=i(p,m,V,h,u[c+6],9,3225465664),h=i(h,p,m,V,u[c+11],14,643717713),V=i(V,h,p,m,u[c+0],20,3921069994),m=i(m,V,h,p,u[c+5],5,3593408605),p=i(p,m,V,h,u[c+10],9,38016083),h=i(h,p,m,V,u[c+15],14,3634488961),V=i(V,h,p,m,u[c+4],20,3889429448),m=i(m,V,h,p,u[c+9],5,568446438),p=i(p,m,V,h,u[c+14],9,3275163606),h=i(h,p,m,V,u[c+3],14,4107603335),V=i(V,h,p,m,u[c+8],20,1163531501),m=i(m,V,h,p,u[c+13],5,2850285829),p=i(p,m,V,h,u[c+2],9,4243563512),h=i(h,p,m,V,u[c+7],14,1735328473),m=r(m,V=i(V,h,p,m,u[c+12],20,2368359562),h,p,u[c+5],4,4294588738),p=r(p,m,V,h,u[c+8],11,2272392833),h=r(h,p,m,V,u[c+11],16,1839030562),V=r(V,h,p,m,u[c+14],23,4259657740),m=r(m,V,h,p,u[c+1],4,2763975236),p=r(p,m,V,h,u[c+4],11,1272893353),h=r(h,p,m,V,u[c+7],16,4139469664),V=r(V,h,p,m,u[c+10],23,3200236656),m=r(m,V,h,p,u[c+13],4,681279174),p=r(p,m,V,h,u[c+0],11,3936430074),h=r(h,p,m,V,u[c+3],16,3572445317),V=r(V,h,p,m,u[c+6],23,76029189),m=r(m,V,h,p,u[c+9],4,3654602809),p=r(p,m,V,h,u[c+12],11,3873151461),h=r(h,p,m,V,u[c+15],16,530742520),m=o(m,V=r(V,h,p,m,u[c+2],23,3299628645),h,p,u[c+0],6,4096336452),p=o(p,m,V,h,u[c+7],10,1126891415),h=o(h,p,m,V,u[c+14],15,2878612391),V=o(V,h,p,m,u[c+5],21,4237533241),m=o(m,V,h,p,u[c+12],6,1700485571),p=o(p,m,V,h,u[c+3],10,2399980690),h=o(h,p,m,V,u[c+10],15,4293915773),V=o(V,h,p,m,u[c+1],21,2240044497),m=o(m,V,h,p,u[c+8],6,1873313359),p=o(p,m,V,h,u[c+15],10,4264355552),h=o(h,p,m,V,u[c+6],15,2734768916),V=o(V,h,p,m,u[c+13],21,1309151649),m=o(m,V,h,p,u[c+4],6,4149444226),p=o(p,m,V,h,u[c+11],10,3174756917),h=o(h,p,m,V,u[c+2],15,718787259),V=o(V,h,p,m,u[c+9],21,3951481745),m=s(m,d),V=s(V,g),h=s(h,l),p=s(p,f);return(a(m)+a(V)+a(h)+a(p)).toLowerCase()}function refreshSessionInfo(e){let n=!1;if(e&&e.results&&e.results.result){const s=e.results.result[0];sessionVerifyHash(s.cr,s)||debugLog("refreshSessionInfo hash does not match. From server: "+s.cr+". Computed here: "+sessionMakeHash()),n=saveUserSessionInfo(s,!1)}else{const n=resultErrorCode(e);"INVALID_PARAMETER"!=n&&"INVALID_TOKEN"!=n||clearUserSessionInfo()}return n}function updateGameInfo(e){e.results.result.row?enginesis.gameInfo=e.results.result.row:enginesis.gameInfo=e.results.result[0],coerceBoolean(enginesis.gameInfo.is_favorite)&&enginesis.favoriteGames.add(parseInt(enginesis.gameInfo.game_id,10))}function updateFavoriteGames(e){const n=e.results.result;enginesis.favoriteGames.clear();for(let e=0;e<n.length;e+=1)enginesis.favoriteGames.add(parseInt(n[e].game_id,10))}function newSessionExpireTime(){return new Date(Date.now()+864e5).toISOString().slice(0,19).replace("T"," ")}function updateGameSessionInfo(e){const n=e.results.result[0];sessionVerifyHash(n.cr,null)&&(updateGameInfo(e),n.authToken||n.authtok?saveUserSessionInfo(n,!0):(enginesis.sessionId=n.session_id,enginesis.sessionExpires=newSessionExpireTime(),n.site_mark&&n.site_mark!=enginesis.anonymousUser.userId&&(enginesis.anonymousUser.userId=n.site_mark,anonymousUserSave())),coerceBoolean(n.tokenExpired)&&!isEmpty(enginesis.refreshToken)&&enginesisContext.sessionRefresh(enginesis.refreshToken,null)),enginesis.siteResources.baseURL=n.siteBaseUrl||"",enginesis.siteResources.profileURL=n.profileUrl||"",enginesis.siteResources.loginURL=n.loginUrl||"",enginesis.siteResources.registerURL=n.registerUrl||"",enginesis.siteResources.forgotPasswordURL=n.forgotPasswordUrl||"",enginesis.siteResources.playURL=n.playUrl||"",enginesis.siteResources.privacyURL=n.privacyUrl||"",enginesis.siteResources.termsURL=n.termsUrl||""}function initializeLocalSessionInfo(){enginesis.loggedInUserInfo={},enginesis.networkId=1,enginesis.sessionId=null,enginesis.sessionExpires=null,enginesis.authToken=null,enginesis.authTokenWasValidated=!1,enginesis.authTokenExpires=null,enginesis.refreshToken=null,enginesis.refreshTokenExpires=null}function updateLoggedInUserInfo(e){let n=!1;if(e&&e.results&&e.results.result){const s=e.results.result[0];sessionVerifyHash(s.cr,s)||debugLog("updateLoggedInUserInfo hash does not match. From server: "+s.cr+". Computed here: "+sessionMakeHash(s)),_saveRefreshToken(s.refresh_token),enginesis.loggedInUserInfo=s,enginesis.isUserLoggedIn=Math.floor(s.user_id)>0,enginesis.networkId=s.network_id,n=saveUserSessionInfo(s,!1)}return n}function clearLoggedInUserInfo(e){e&&e.results&&e.results.result&&(initializeLocalSessionInfo(),clearUserSessionInfo())}function sessionDayStamp(){return Math.floor(Date.now()/1728e5)}function coerceUserInfoFromUserInfo(e){const n=enginesis.loggedInUserInfo||{},s=e||{},t={siteId:enginesis.siteId,userId:coerceNotNull(s.userId,s.user_id,n.user_id,0),userName:coerceNotEmpty(s.userName,s.user_name,n.user_name,""),accessLevel:coerceNotNull(s.accessLevel,s.access_level,n.access_level,10),siteUserId:coerceNotEmpty(s.siteUserId,s.site_user_id,n.site_user_id,""),networkId:coerceNotNull(s.networkId,s.network_id,n.network_id,1),gameId:s.gameId||enginesis.gameId,dayStamp:s.dayStamp||sessionDayStamp(),siteMark:0};return 0==t.userId&&(isNull(s.siteMark)?enginesis.anonymousUser&&(t.siteMark=enginesis.anonymousUser.userId):t.siteMark=s.siteMark),t}function sessionMakeHash(e){const n=coerceUserInfoFromUserInfo(e);return md5(`s=${n.siteId}&u=${n.userId}&d=${n.dayStamp}&n=${n.userName}&g=${n.gameId}&i=${n.siteUserId}&w=${n.networkId}&l=${n.accessLevel}&m=${n.siteMark}&k=${enginesis.developerKey}`)}function sessionVerifyHash(e,n){const s=coerceUserInfoFromUserInfo(n);let t=e==sessionMakeHash(s);return t||(s.dayStamp=sessionDayStamp(),t=e==sessionMakeHash(s),t&&enginesisContext.sessionRefresh(_getRefreshToken(),null).then(function(e){debugLog("sessionVerifyHash users authentication has been refreshed. "+e.toString())},function(e){debugLog("sessionVerifyHash refresh error "+e.toString())}).catch(function(e){debugLog("sessionVerifyHash refresh exception "+e.toString())})),t||debugLog("sessionVerifyHash hash does not match. From server: "+e+". Computed here: "+sessionMakeHash(s)+" from "+JSON.stringify(s)),t}function callbackPriority(e,n,s,t){preprocessEnginesisResult(e).then(function(e){null!=s?s(e):null!=t&&t(e),null!=n&&n(e)})}function removeFromServiceQueue(e){let n=enginesis.serviceQueue,s=0;return null!=n&&n.length>0&&(n=n.filter(function(n){const t=n.state_seq==e;return t&&(n.state_status=2,s+=1),!t}),enginesis.serviceQueue=n),enginesis.serviceQueueRestored>0&&s>0&&(enginesis.serviceQueueRestored-=s,saveServiceQueue()),s}function saveServiceQueue(){return saveObjectWithKey(enginesis.serviceQueueSaveKey,enginesis.serviceQueue),!0}function restoreServiceQueue(){let e=loadObjectWithKey(enginesis.serviceQueueSaveKey);return null==e?(e=[],enginesis.serviceQueueRestored=0):(saveObjectWithKey(enginesis.serviceQueueSaveKey,[]),enginesis.serviceQueueRestored=enginesis.serviceQueue.length),enginesis.serviceQueue=e,resetServiceQueue(),enginesis.serviceQueueRestored>0}function resetServiceQueue(){const e=enginesis.serviceQueue;if(null!=e&&e.length>0)for(let n=0;n<e.length;n+=1)e[n].state_status=0;return e}function formatHTTPHeader(e){const n=Object.assign({Accept:"application/json","X-DeveloperKey":enginesis.developerKey},e);return enginesis.authTokenWasValidated&&(n.Authentication="Bearer "+enginesis.authToken),n}function sendNodeRequest(e,n,s){if(null==enginesis.nodeRequest){if("undefined"==typeof window||void 0===window.fetch)throw new Error("enginesis.nodeRequest is not set in the node.js environment");enginesis.nodeRequest=window.fetch}return enginesis.nodeRequest(enginesis.siteResources.serviceURL,{method:"POST",headers:formatHTTPHeader(),body:new URLSearchParams(n)}).then(async function(t){if(200!=t.status){const i="Service error "+t.status+" from "+enginesis.siteResources.serviceURL;serviceRequestComplete(n.state_seq,forceErrorResponseString(e,n.state_seq,"OFFLINE",i,n),s)}else{let e;e=void 0===n.response||"json"==n.response?await t.json():t.body,serviceRequestComplete(n.state_seq,e,s)}}).catch(function(t){const i="Internal error posting to "+enginesis.siteResources.serviceURL+": "+t.toString();debugLog(i),serviceRequestComplete(n.state_seq,forceErrorResponseString(e,n.state_seq,"OFFLINE",i,n),s)}),!0}function getNextUnprocessedMessage(){const e=enginesis.serviceQueue;let n=null;for(let s=0;s<e.length;s+=1){const t=e[s];if(void 0===t.state_status||0==t.state_status){t.state_status=1,n=t;break}}return n}function processNextMessage(e,n){if(enginesis.isOnline&&enginesis.serviceQueue.length>0){const s=getNextUnprocessedMessage();if(null!=s){const n=s.fn,t=s.overRideCallBackFunction;let i;enginesis.isNodeBuild?sendNodeRequest(n,s,function(n){callbackPriority(n,e,t,enginesis.callBackFunction)}):fetch(enginesis.siteResources.serviceURL,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:formatHTTPHeader(),body:convertParamsToFormData(s)}).then(function(i){if(removeFromServiceQueue(s.state_seq),200==i.status)i.json().then(function(r){let o;null==r?(debugLog("Enginesis service error for "+n+": "+i.text()),o="Enginesis service while contacting Enginesis at "+enginesis.serverHost+" for "+n,r=forceErrorResponseObject(n,s.state_seq,"SERVICE_ERROR",o,s)):r.fn=n,callbackPriority(r,e,t,enginesis.callBackFunction)}).catch(function(i){const r="Invalid response from Enginesis at "+enginesis.serverHost+" for "+n+": "+i.toString(),o=forceErrorResponseObject(n,s.state_seq,"SERVICE_ERROR",r,s);debugLog(r),callbackPriority(o,e,t,enginesis.callBackFunction)});else{const r="Network error "+i.status+" while contacting Enginesis at "+enginesis.serverHost+" for "+n,o=forceErrorResponseObject(n,s.state_seq,"SERVICE_ERROR",r,s);debugLog(r),callbackPriority(o,e,t,enginesis.callBackFunction)}},function(r){i=setOffline()?"Enginesis Network error encountered, assuming we're offline. "+enginesis.serverHost+" for "+n+": "+r.toString():"Enginesis is already offline, leaving this message on the queue.",debugLog(i),callbackPriority(forceErrorResponseObject(n,s.state_seq,"OFFLINE",i,s),e,t,enginesis.callBackFunction)}).catch(function(r){i=setOffline()?"Enginesis Network error encountered, assuming we're offline. "+enginesis.serverHost+" for "+n+": "+r.toString():"Enginesis is already offline, leaving this message on the queue.",debugLog(i),callbackPriority(forceErrorResponseObject(n,s.state_seq,"OFFLINE",i,s),e,t,enginesis.callBackFunction)})}else null!=n&&n(new Error("Queue is empty"))}else null!=n&&n(new Error("Offline or queue is empty"))}function sendRequest(e,n,s){return new Promise(function(t,i){if(!enginesis.disabled&&isValidOperationalState()){const r=serverParamObjectMake(e,n);if(r.overRideCallBackFunction=s,enginesis.serviceQueue.push(r),enginesis.isOnline)processNextMessage(t,i);else{const i="Enginesis is offline. Message "+e+" will be processed when network connectivity is restored.",o=forceErrorResponseObject(e,r.state_seq,"OFFLINE",i,n);saveServiceQueue(),debugLog(i),callbackPriority(o,t,s,enginesis.callBackFunction)}}else{let i;i=enginesis.disabled?forceErrorResponseObject(e,0,"DISABLED","Enginesis is disabled.",n):forceErrorResponseObject(e,0,"VALIDATION_FAILED","Enginesis internal state failed validation.",n),callbackPriority(i,t,s,enginesis.callBackFunction)}})}function immediateErrorResponse(e,n,s,t,i){return new Promise(function(r){callbackPriority(forceErrorResponseObject(e,n.state_seq||0,s,t,n),r,i,enginesis.callBackFunction)})}function serverParamObjectMake(e,n){enginesis.internalStateSeq+=1;const s={fn:e,language_code:enginesis.languageCode,site_id:enginesis.siteId,state_seq:enginesis.internalStateSeq,state_status:0,response:"json"};if(enginesis.loggedInUserInfo&&enginesis.authTokenWasValidated&&0!=Math.floor(enginesis.loggedInUserInfo.user_id)&&(s.authtok=enginesis.authToken,"SessionRefresh"==e&&(s.logged_in_user_id=enginesis.loggedInUserInfo.user_id)),enginesis.gameId&&(s.game_id=enginesis.gameId),null!=n)for(const e in n)n.hasOwnProperty(e)&&(s[e]=n[e]);return s}function forceErrorResponseString(e,n,s,t,i){return JSON.stringify(forceErrorResponseObject(e,n,s,t,i))}function forceErrorResponseObject(e,n,s,t,i){null!=e&&""!=e||(e="unknown"),void 0!==n&&null!=n||(n=0),void 0!==i&&null!=i||(i={}),void 0!==i.fn&&null!=i.fn||(i.fn=e),void 0!==i.state_seq&&null!=i.state_seq||(i.state_seq=n);return{fn:e,results:{result:[],status:{success:!(""==s||"NO_ERROR"==s)?"0":"1",message:s,extended_info:t},passthru:i}}}function convertParamsToFormData(e){let n;n=enginesis.isBrowserBuild?new FormData:{};for(const s in e)e.hasOwnProperty(s)&&"function"!=typeof e[s]&&"overRideCallBackFunction"!=s&&(enginesis.isBrowserBuild?n.append(s,e[s]):n[s]=e[s]);return n}function setOffline(){let e;return enginesis.isOnline?(saveServiceQueue(),e=!0):e=!1,enginesis.isOnline=!1,e}function restoreOnline(){enginesis.isOnline;function e(n){enginesis.isOnline&&enginesis.serviceQueue.length>0?processNextMessage(function(){e(n)},function(){e(n)}):n()}return enginesis.isOnline=!0,restoreServiceQueue(),new Promise(function(n){e(n)})}function setProtocolFromCurrentLocation(){return enginesis.isBrowserBuild&&!enginesis.isNodeBuild?enginesis.useHTTPS="https:"==window.location.protocol:enginesis.useHTTPS=!0,enginesis.useHTTPS}function getProtocol(){return enginesis.useHTTPS?"https://":"http://"}function serverTail(e){let n=e||enginesis.serverHost,s=n.indexOf("://");s>=0&&(n=n.substring(s+3)),s=n.indexOf("/"),s>0&&(n=n.substring(0,s));const t=n.split("."),i=t.length;return i>1&&(n=t[i-2]+"."+t[i-1]),n}function qualifyAndSetServerStage(e){const n=enginesis.isBrowserBuild?window.location.host:"enginesis-l.com";let s,t=!1;switch(enginesis.serverHost=null,null==e&&(e="*"),e){case"":case"-l":case"-d":case"-q":case"-x":enginesis.serverStage=e;break;case"*":"localhost"==n.substring(0,9)?(e="-l",t=!0):(s=/-[ldqx]\./.exec(n),e=null!=s&&s.index>0?n.substring(s.index,s.index+2):""),enginesis.serverStage=e;break;default:s=/-[ldqx]\./.exec(e),null!=s&&s.index>0?enginesis.serverStage=e.substring(s.index,s.index+2):enginesis.serverStage="",enginesis.serverHost=e}if(null===enginesis.serverHost){const e="enginesis",s=n.split("."),i=s.length;if(i>1){const n=s[i-2].replace(/-[ldqx]$/,"");enginesis.serverHost=n!=e?e+".":"",enginesis.serverHost+=n+enginesis.serverStage+"."+s[i-1]}else enginesis.serverHost=t?"enginesis-l.com":n}return enginesis.siteResources.serviceURL=getProtocol()+enginesis.serverHost+"/index.php",enginesis.siteResources.avatarImageURL=getProtocol()+enginesis.serverHost+"/avatar/index.php",enginesis.siteResources.assetUploadURL=getProtocol()+enginesis.serverHost+"/procs/asset.php",enginesis.serverStage}function touchDevice(){let e=!1;return enginesis.isBrowserBuild&&("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(e=!0),e}function setPlatform(){enginesis.isBrowserBuild?(enginesis.platform="browser",enginesis.locale=navigator.language,enginesis.isNativeBuild="file:"==window.location.protocol,enginesis.isTouchDeviceFlag=touchDevice()):(enginesis.platform="nodejs",enginesis.locale="en",enginesis.isNativeBuild=!0,enginesis.isTouchDeviceFlag=!1)}function setLanguageCode(e){return isEmpty(e)?e="en":e.length>2&&(e=e.substring(0,2)),e}function queryStringToObject(e){const n=/([^&=]+)=?([^&]*)/g,s={};let t,i;function r(e){return decodeURIComponent(e.replace(/\+/g," "))}if(!e&&enginesis.isBrowserBuild)i=window.location.search.substring(1);else{if(!e)return s;i=e}for("?"==i[0]&&(i=i.substring(1));null!=(t=n.exec(i));)s[r(t[1])]=r(t[2]);return s}function cookieGet(e){return"undefined"!=typeof window&&e&&decodeURIComponent(window.document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null}function sessionCookieDomain(e){return serverTail(e)}function cookieSet(e,n,s,t,i,r){let o;if(i||(i=sessionCookieDomain(enginesis.serverHost)),!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;if(null==n)o="; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:"");else{const e="expires=Fri, 31 Dec 9999 23:59:59 GMT",a="SameSite=LAX";let u="";if(void 0===r&&(r=!0),"object"==typeof n&&(n=JSON.stringify(n)),s)switch(s.constructor){case Number:u=s===1/0?e:"; max-age="+s;break;case String:u="expires="+s;break;case Date:u="expires="+s.toUTCString();break;default:u=e}else u=e;o=encodeURIComponent(n)+"; "+u+"; "+(i?"domain="+i+"; ":"")+(t?"path="+t+"; ":"")+a+"; "+(r?"Secure;":"")}return"undefined"==typeof window||void 0===window.document?o:(window.document.cookie=encodeURIComponent(e)+"="+o,!0)}function restoreUserFromAuthToken(e){let n=!1,s=null;if(isEmpty(e)&&isEmpty(e=cookieGet(enginesis.SESSION_COOKIE))){const n=queryStringToObject();void 0!==n.authtok&&(e=n.authtok),isEmpty(e)&&(s=loadObjectWithKey(enginesis.SESSION_USERINFO),null!=s&&s.authToken&&(e=s.authToken))}return isEmpty(e)||(null==s&&(s=JSON.parse(cookieGet(enginesis.SESSION_USERINFO)),null==s&&(s=loadObjectWithKey(enginesis.SESSION_USERINFO))),null!=s?(enginesis.authToken=e,enginesis.authTokenExpires=null,enginesis.authTokenWasValidated=!0,enginesis.isUserLoggedIn=Math.floor(s.user_id)>0,enginesis.loggedInUserInfo=s,enginesis.networkId=Math.floor(s.network_id),n=!0):debugLog("restoreUserFromAuthToken valid token but no cached user "+e)),n}function clearUserSessionInfo(){removeObjectWithKey(enginesis.SESSION_USERINFO),_clearRefreshToken(),cookieSet(enginesis.SESSION_USERINFO,null,0,"/",sessionCookieDomain(enginesis.serverHost),!0),initializeLocalSessionInfo()}function saveUserSessionInfo(e){let n;if(e){if(n=sessionVerifyHash(e.cr,null),!n){const n=sessionMakeHash(enginesis.loggedInUserInfo);debugLog("Possible payload compromise: provided hash "+e.cr+" does not match computer here "+n)}n=!0,enginesis.sessionId=e.session_id,enginesis.sessionExpires=newSessionExpireTime(),enginesis.authToken=e.authToken||e.authtok,enginesis.authTokenExpires=enginesis.sessionExpires,enginesis.loggedInUserInfo.authToken=enginesis.authToken,enginesis.loggedInUserInfo.authTokenExpires=e.expires,enginesis.authTokenWasValidated=!0,e.refresh_token&&(enginesis.refreshToken=e.refresh_token,enginesis.refreshTokenExpires=e.expires),saveObjectWithKey(enginesis.SESSION_USERINFO,enginesis.loggedInUserInfo)}else n=!1;return n}function restoreUserSession(e){restoreUserFromAuthToken(e)||restoreUserSessionInfo(),enginesis.isUserLoggedIn||anonymousUserLoad()}function restoreUserSessionInfo(){let e=loadObjectWithKey(enginesis.SESSION_USERINFO);if(null==e&&(e=cookieGet(enginesis.SESSION_USERINFO),null!=e))try{e=JSON.parse(e)}catch(n){e=null,clearUserSessionInfo()}if(null!=e){const n=sessionMakeHash({siteId:enginesis.siteId,userId:e.userId,userName:e.userName,siteUserId:e.siteUserId||"",networkId:e.networkId||1,accessLevel:e.accessLevel,siteKey:enginesis.developerKey});n!=e.cr&&debugLog("restoreUserSessionInfo hash does not match. From server: "+e.cr+". Computed here: "+n),enginesis.loggedInUserInfo=e,isEmpty(e.session_id)&&debugLog("*** enginesis.restoreUserSessionInfo unexpected server response from "+JSON.stringify(e)),enginesis.networkId=e.network_id,enginesis.sessionId=e.session_id,enginesis.sessionExpires=e.session_expires,enginesis.authToken=e.authToken,enginesis.authTokenExpires=e.session_expires,enginesis.authTokenWasValidated=!0,enginesis.refreshToken=e.refresh_token,enginesis.refreshTokenExpires=e.expires,enginesis.isUserLoggedIn=isUserLoggedIn()}else enginesis.isUserLoggedIn&&(enginesis.isUserLoggedIn=isUserLoggedIn(),debugLog("enginesis.restoreUserSessionInfo we think the user is logged in but wasn't cached"));return enginesis.isUserLoggedIn}function verifyUserSessionInfo(){return new Promise(function(e,n){const s=enginesis.loggedInUserInfo,t=loadObjectWithKey(enginesis.SESSION_COOKIE);let i,r=!1;if(null!=t){i=t.sessionExpires?new Date(t.sessionExpires):new Date;const o=6e4*i.getTimezoneOffset(),a=Date.now().valueOf()>i.valueOf()-o,u=sessionMakeHash({siteId:enginesis.siteId,userId:s.user_id,userName:s.user_name,siteUserId:s.site_user_id||"",networkId:s.network_id||1,accessLevel:s.access_level,siteKey:enginesis.developerKey}),c=u==t.cr&&Math.floor(s.user_id)==Math.floor(t.user_id);if(!a&&c)r=!0,e(r);else if(a)debugLog("verifyUserSessionInfo Session expired but we think we can refresh it."),enginesisContext.sessionRefresh(_getRefreshToken(),null).then(function(){r=!0,e(r)},function(e){n(e)}).catch(function(e){n(e)});else{const e="Session hash does not match but session not expired.";debugLog("verifyUserSessionInfo "+e+" from cache: "+t.cr+". Computed here: "+u),n(new Error(e))}}else e(r)})}function _saveRefreshToken(e){if(!isEmpty(e)){const n={refreshToken:e,timestamp:(new Date).getTime()};saveObjectWithKey(enginesis.refreshTokenStorageKey,n)}}function _getRefreshToken(){let e=enginesis.refreshToken;return isEmpty(e)&&(restoreUserSessionInfo(),e=enginesis.refreshToken,isEmpty(e)&&(e=null)),e}function _clearRefreshToken(){removeObjectWithKey(enginesis.refreshTokenStorageKey)}function anonymousUserInitialize(){return{dateCreated:new Date,dateLastVisit:new Date,subscriberEmail:"",userId:0,userName:"",favoriteGames:null,gamesPlayed:new Set,cr:""}}function anonymousUserLoad(){if(null==enginesis.anonymousUser)if(enginesis.anonymousUser=loadObjectWithKey(enginesis.anonymousUserKey),null==enginesis.anonymousUser)enginesis.anonymousUser=anonymousUserInitialize();else{(enginesis.anonymousUser.cr||"")!=anonymousUserHash()&&(enginesis.anonymousUser=anonymousUserInitialize()),Array.isArray(enginesis.anonymousUser.favoriteGames)&&(enginesis.favoriteGames=new Set(enginesis.anonymousUser.favoriteGames),enginesis.anonymousUser.favoriteGames=null),Array.isArray(enginesis.anonymousUser.gamesPlayed)&&(enginesis.anonymousUser.gamesPlayed=new Set(enginesis.anonymousUser.gamesPlayed))}return enginesis.anonymousUser}function anonymousUserSave(){if(null!=enginesis.anonymousUser){const e=enginesis.anonymousUser;e.favoriteGames=Array.from(enginesis.favoriteGames),e.gamesPlayed=Array.from(e.gamesPlayed),e.cr=anonymousUserHash(),saveObjectWithKey(enginesis.anonymousUserKey,e),e.favoriteGames=null,e.gamesPlayed=new Set(e.gamesPlayed)}}function anonymousUserHash(){const e=enginesis.anonymousUser;return md5(e.subscriberEmail+e.userId+e.userName+enginesis.developerKey)}function safeData(e){let n;return n="string"!=typeof e?JSON.stringify(e):e,encodeURIComponent(n)}function encryptScoreSubmit(e,n,s,t,i,r,o,a){return new Promise(function(u,c){let d;d="string"!=typeof r?JSON.stringify(r):r,a||(a=enginesis.sessionId),encryptString(`site_id=${e}&user_id=${n}&game_id=${s}&level_id=${t}&score=${i}&time_played=${o}&game_data=${d}`,a).then(function(e){e?u(e):c(new Error("Internal data encryption failed, verify your session is good."))}).catch(function(e){c(e)})})}function _requestFileUpload(e,n,s){return new Promise(function(t,i){null==enginesis.assetUploadQueue&&(enginesis.assetUploadQueue=[]);let r="",o="";const a={target:e,token:null,uploadId:0,fileName:n,fileSize:s.length,serverURL:"",uploadTime:Date.now()},u={site_id:enginesis.siteId,action:"request",target:a.target,file:a.fileName,size:a.fileSize,game_id:enginesis.gameId},c={method:"POST",mode:"cors",credentials:"same-origin",cache:"default",headers:formatHTTPHeader(),body:convertParamsToFormData(u)};fetch(enginesis.siteResources.assetUploadURL,c).then(function(e){if(e&&e.ok){const i=e.headers.get("content-type");i&&i.includes("application/json")?e.json().then(function(e){null!=e?e.status&&"1"==e.status.success&&e.results?(a.token=e.results.token,a.uploadId=e.results.id,enginesis.assetUploadQueue.push(a),_completeFileUpload(a,s).then(function(e){t(e)},function(e){t(e)}).catch(function(e){o="SERVICE_ERROR",r="Error: "+e.toString()+" Received from service with "+n+" with size "+a.fileSize+"."})):(o="SERVICE_ERROR",r="Error: "+e.status.extended_info+" Received from service with "+n+" with size "+a.fileSize+"."):(o="SERVICE_ERROR",r="There was a service error during the upload operation. The support team has been notified.")}).catch(function(e){o="SERVICE_ERROR",r="Unexpected response received from service: "+e.toString()}):(o="SERVICE_ERROR",r="Unexpected response received from service when requesting upload token.")}else o="SERVICE_ERROR",r="Error received from service when requesting upload token.";""!=o&&i(makeErrorResponse(o,r,u))},function(e){o="SERVICE_ERROR",r="Network error from service when requesting token. "+e.toString(),i(makeErrorResponse(o,r,u))}).catch(function(e){o="SERVICE_ERROR",r="Unexpected response received from service when requesting token with "+e.toString()+".",i(makeErrorResponse(o,r,u))})})}function _completeFileUpload(e,n){return new Promise(function(s,t){const i={site_id:enginesis.siteId,game_id:enginesis.gameId,action:"upload",target:e.target,file:e.fileName,size:e.fileSize,token:e.token,id:e.uploadId,image:n},r={method:"POST",mode:"cors",credentials:"same-origin",cache:"default",headers:formatHTTPHeader(),body:convertParamsToFormData(i)};let o="",a="";fetch(enginesis.siteResources.assetUploadURL,r).then(function(e){if(e&&e.ok){const n=e.headers.get("content-type");n&&n.includes("application/json")?e.json().then(function(e){null!=e?e.status&&"1"==e.status.success?s(e):(o=e.status.message,a=e.status.extended_info):(o="SERVICE_ERROR",a="There was a service error during the upload operation. The support team has been notified."),""!=o&&t(makeErrorResponse(o,a,i))}).catch(function(e){o="SERVICE_ERROR",a=e.toString(),t(makeErrorResponse(o,a,i))}):(o="SERVICE_ERROR",a="Unexpected response received from service when requesting upload token.")}else o="SERVICE_ERROR",a="Error received from service when requesting upload token.";""!=o&&t(makeErrorResponse(o,a,i))},function(e){a="Network error from service when requesting token. "+e.toString(),t(makeErrorResponse("SERVICE_ERROR",a,i))}).catch(function(e){a="Unexpected response received from service when requesting token with "+e.toString()+".",t(makeErrorResponse("SERVICE_ERROR",a,i))})})}async function encryptString(e,n){return new Promise(function(s,t){const i="AES-CBC";window.crypto.subtle.importKey("raw",stringToByteArray(n),{name:i},!0,["encrypt","decrypt"]).then(function(r){const o=new TextEncoder;window.crypto.subtle.encrypt({name:i,iv:stringToByteArray(n.substring(3,19))},r,o.encode(e)).then(function(e){s(arrayBufferToBase64(e))}).catch(function(e){t(e)})}).catch(function(e){t(e)})})}async function decryptString(e,n){return new Promise(function(s,t){const i="AES-CBC";window.crypto.subtle.importKey("raw",stringToByteArray(n),{name:i},!0,["encrypt","decrypt"]).then(function(r){window.crypto.subtle.decrypt({name:i,iv:stringToByteArray(n.substring(3,19))},r,base64ToArrayBuffer(e)).then(function(e){const n=(new TextDecoder).decode(e);s(n)}).catch(function(e){t(e)})}).catch(function(e){t(e)})})}function isUserLoggedIn(){return enginesis.isUserLoggedIn=enginesis.loggedInUserInfo&&Math.floor(enginesis.loggedInUserInfo.user_id)>0&&""!=enginesis.authToken&&enginesis.authTokenWasValidated,enginesis.isUserLoggedIn}export default{init:function(e){let n=null;return enginesisContext=this,initializeLocalSessionInfo(),e&&(enginesis.siteId=void 0!==e.siteId?e.siteId:0,enginesis.gameId=void 0!==e.gameId?e.gameId:0,enginesis.gameKey=void 0!==e.gameKey?e.gameKey:"",enginesis.gameGroupId=void 0!==e.gameGroupId?e.gameGroupId:0,enginesis.languageCode=setLanguageCode(e.languageCode),enginesis.serverStage=void 0!==e.serverStage?e.serverStage:"*",enginesis.developerKey=void 0!==e.developerKey?e.developerKey:"",enginesis.callBackFunction=void 0!==e.callBackFunction?e.callBackFunction:null,n=void 0!==e.authToken?e.authToken:null),setPlatform(),setProtocolFromCurrentLocation(),qualifyAndSetServerStage(enginesis.serverStage),restoreUserSession(n),restoreServiceQueue()&&(enginesis.isBrowserBuild?window.setTimeout(restoreOnline,500):setTimeout(restoreOnline,500)),isValidOperationalState()},md5:function(e){return md5(e)},request:function(e,n){return"object"==typeof e&&"string"==typeof e.fn&&(e=(n=e).fn),sendRequest(e,n,null)},versionGet:function(){return enginesis.VERSION},isUserLoggedIn:function(){return isUserLoggedIn()},userIdGet:function(){return enginesis.isUserLoggedIn?Math.floor(enginesis.loggedInUserInfo.user_id):enginesis.anonymousUser.userId},sessionIdGet:function(){return enginesis.sessionId},sessionGet:function(){return{sessionId:enginesis.sessionId,sessionExpires:enginesis.sessionExpires}},sessionDomain:function(e){return sessionCookieDomain(e)},isEnginesisResult:function(e){return e&&e.hasOwnProperty("results")&&e.results.hasOwnProperty("status")&&e.results.status.hasOwnProperty("success")},getLastResponse:function(){return enginesis.lastResponse?enginesis.lastResponse.status:makeErrorResponse("","",{})},isError:function(e){return!resultIsSuccess(e)},toError:function(e){let n=null,s="";e&&(e.status?n=e.status:e.results&&e.results.status&&(n=e.results.status)),null==n&&(n={message:"INVALID_PARAMETER",extended_info:"Result was not a valid result object."}),s=n.extended_info?n.extended_info:n.message;const t=new Error(s);return t.code=n.message,t},toErrorString:function(e){let n="";return e&&e.results&&e.results.status&&(n+=e.results.status.message,e.results.status.extended_info&&(n+=": "+e.results.status.extended_info)),n},error:function(e){return resultErrorCode(e)},makeErrorResponse:function(e,n,s,t,i){return forceErrorResponseObject(e,n,s,t,i)},resultToString:function(e){return resultIsSuccess(e)?e.results.passthru.fn:e.results.status.message+(e.results.status.extended_info?": "+e.results.status.extended_info:"")},pause:function(){enginesis.isPaused=!0},resume:function(){enginesis.isPaused=!1,enginesisContext.sessionRefreshIfExpired().then(function(e){debugLog("Session was "+(e?"refreshed":"OK"))}).catch(function(e){debugLog("Session sessionRefreshIfExpired exception "+e.toString())})},getLoggedInUserInfo:function(){if(enginesis.isUserLoggedIn){const e={};for(const n in enginesis.loggedInUserInfo)enginesis.loggedInUserInfo.hasOwnProperty(n)&&(e[n]=enginesis.loggedInUserInfo[n]);return e}return null},isTouchDevice:function(){return enginesis.isTouchDeviceFlag},queryStringToObject:queryStringToObject,setNodeRequest:function(e){enginesis.nodeRequest=e},isValidUserName:function(e){return"string"==typeof e&&e.trim().length==e.length&&/^[a-zA-Z0-9_@!~\$\.\-\|\'\s?]{3,50}$/.test(e)},isValidEmail:function(e){return/\S+@\S+\.\S+/.test(e)},cleanUserName:function(e){let n="";return"string"==typeof e&&(n=e.replace(/[^a-zA-Z0-9_@!~\$\.\-\|\s]/g,""),n=n.trim().replace(/\s+/," ")),n},isValidPassword:function(e){let n;return n="string"==typeof e&&(e.length==e.trim().length&&null!==e.match(/^[ -~]{8,32}$/)),n},validateGender:function(e){return validGender(e)},saveRefreshToken:function(e){_saveRefreshToken(e)},getRefreshToken:function(){return _getRefreshToken()},serverStageSet:function(e){return qualifyAndSetServerStage(e)},serverStageGet:function(){return enginesis.serverStage},setHTTPS:function(e){return enginesis.useHTTPS=void 0===e||coerceBoolean(e),enginesis.useHTTPS},isHTTPS:function(){return enginesis.useHTTPS},getProtocol:function(){return getProtocol()},serverBaseUrlGet:function(){return enginesis.serverHost},getSiteSpecificURLs:function(){const e=enginesis.siteResources;let n;return null!=e.profileURL&&e.profileURL.length>0?(n=getProtocol()+e.baseURL,{root:n,forgotPassword:n+e.forgotPasswordURL,login:n+e.loginURL,play:n+e.playURL,privacy:n+e.privacyURL,profile:n+e.profileURL,register:n+e.registerURL,terms:n+e.termsURL}):(n=getProtocol()+"varyn"+enginesis.serverStage+".com",{root:n,forgotPassword:n+"/procs/forgotpass.php",login:n+"/profile/",play:n+"/play/",privacy:n+"/privacy/",profile:n+"/profile/",register:n+"/profile/?action=signup",terms:n+"/tos/"})},gameIdGet:function(){return enginesis.gameId},gameIdSet:function(e,n){return enginesis.gameId!=e&&(enginesis.gameInfo=null),enginesis.gameKey=n||"",enginesis.gameId=e},gameInfoGet:function(){return enginesis.gameInfo},gameGroupIdGet:function(){return enginesis.gameGroupId},gameGroupIdSet:function(e){return enginesis.gameGroupId=e},siteIdGet:function(){return enginesis.siteId},supportedSSONetworks:function(){return enginesis.supportedNetworks},getGameImageURL:function(e){const n="enginesisTestGame";let s=null,t=0,i=0,r=null,o=getProtocol()+enginesis.serverHost+"/games/";return void 0!==e&&null!=e&&(isEmpty(e.game_name)?isEmpty(e.gameName)||(s=e.gameName):s=e.game_name,isEmpty(e.format)||(r=e.format),void 0!==e.width&&(t=e.width),void 0!==e.height&&(i=e.height)),isEmpty(s)&&(s=null!=enginesis.gameInfo&&enginesis.gameInfo.game_name||n),"quiz"!=s&&"quiz_"!=s.substring(0,5)||(s="quiz/"+(e.game_id||enginesis.gameInfo.game_id)),o+=s+"/images/",(isEmpty(t)||"*"==t)&&(t=600),(isEmpty(i)||"*"==i)&&(i=450),o+=t==i?t.toString():t+"x"+i,isEmpty(r)?r="png":("."==r[0]&&(r=r.substring(1)),r.match(/(png|jpg|svg|webp)/i)||(r="png")),o+="."+r,o},getDateNow:function(){return(new Date).toISOString().slice(0,19).replace("T"," ")},restoreOnline:function(){return restoreOnline()},requestServiceAPI:function(e,n){return new Promise(function(s){if(enginesis.isNodeBuild){if(sendNodeRequest(serviceName,n,function(e){callbackPriority(e,s,overRideCallBackFunction,enginesis.callBackFunction)}),null==enginesis.nodeRequest){if("undefined"==typeof window||void 0===window.fetch)throw new Error("enginesis.nodeRequest is not set in the node.js environment");enginesis.nodeRequest=window.fetch}enginesis.nodeRequest(e,{method:"POST",headers:formatHTTPHeader(),body:new URLSearchParams(n)}).then(async function(t){if(200!=t.status){const e="Service error "+t.status+" from "+enginesis.siteResources.serviceURL;s(forceErrorResponseString(serviceName,n.state_seq,"OFFLINE",e,n))}else t.json().then(function(e){s(e)}).catch(function(t){const i="Invalid response from Non-standard API at "+enginesis.serverHost+" for "+e+": "+t.toString(),r=forceErrorResponseObject(e,n.state_seq,"SERVICE_ERROR",i,n);debugLog(i),s(r)})}).catch(function(e){const t="Internal error posting to "+enginesis.siteResources.serviceURL+": "+e.toString();debugLog(t),s(forceErrorResponseString(serviceName,n.state_seq,"OFFLINE",t,n))})}else fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:formatHTTPHeader(),body:convertParamsToFormData(n)}).then(function(t){if(200==t.status)t.json().then(function(i){let r;null==i&&(debugLog("Non-standard API error for "+e+": "+t.text()),r="Non-standard API service error while contacting Enginesis at "+enginesis.serverHost+" for "+e,i=forceErrorResponseObject(e,n.state_seq,"SERVICE_ERROR",r,n)),s(i)}).catch(function(t){const i="Invalid response from Non-standard API at "+enginesis.serverHost+" for "+e+": "+t.toString(),r=forceErrorResponseObject(e,n.state_seq,"SERVICE_ERROR",i,n);debugLog(i),s(r)});else{const i="Network error "+t.status+" while contacting Non-standard API at "+enginesis.serverHost+" for "+e,r=forceErrorResponseObject(e,n.state_seq,"SERVICE_ERROR",i,n);debugLog(i),s(r)}},function(t){errorMessage="Enginesis Network error encountered, assuming we're offline. "+enginesis.serverHost+" for "+e+": "+t.toString(),debugLog(errorMessage),s(forceErrorResponseObject(e,n.state_seq,"OFFLINE",errorMessage,n))}).catch(function(t){errorMessage="Enginesis Network error encountered, assuming we're offline. "+enginesis.serverHost+" for "+serviceName+": "+t.toString(),debugLog(errorMessage),s(forceErrorResponseObject(e,n.state_seq,"OFFLINE",errorMessage,n))})})},sessionBegin:function(e,n,s){const t="SessionBegin";if(!isValidOperationalState())return immediateErrorResponse(t,{},"VALIDATION_FAILED","The internal system is not in the proper operational state.",s);let i=0;enginesis.isUserLoggedIn||(cookieSet(enginesis.anonymousUserKey,enginesis.anonymousUser,86400,"/",sessionCookieDomain(enginesis.serverHost),!0),i=enginesis.anonymousUser.userId),enginesis.gameId=isEmpty(n)?enginesisContext.gameIdGet():n,enginesis.gameKey=isEmpty(e)?enginesis.gameKey:e;return sendRequest(t,{game_id:enginesis.gameId,gamekey:enginesis.gameKey,site_mark:i},s)},sessionRefresh:function(e,n){const s="SessionRefresh";if(isEmpty(e)&&isEmpty(e=_getRefreshToken()))return immediateErrorResponse(s,{},"NOT_LOGGED_IN","The requested service requires a logged in user.",n);let t=0;enginesis.isUserLoggedIn||(t=enginesis.anonymousUser.userId);return sendRequest(s,{refresh_token:e,game_id:enginesis.gameId,gamekey:enginesis.gameKey,site_mark:t},n)},sessionRefreshIfExpired:function(){return verifyUserSessionInfo()},voteForURIUnauth:function(e,n,s,t,i){return sendRequest("VoteForURIUnauth",{uri:e,vote_group_uri:n,vote_value:s,security_key:t},i)},voteCountPerURIGroup:function(e,n){return sendRequest("VoteCountPerURIGroup",{vote_group_uri:e},n)},developerGet:function(e,n){return sendRequest("DeveloperGet",{developer_id:e},n)},gameDataGet:function(e,n){return sendRequest("GameDataGet",{game_data_id:e},n)},gameDataCreate:function(e,n,s,t,i,r,o,a,u,c,d){return sendRequest("GameDataCreate",{from_address:e,from_name:n,to_address:s,to_name:t,user_msg:i,user_files:r,game_data:safeData(o),name_tag:a,add_to_gallery:u?1:0,last_score:c},d)},sendToFriend:function(e,n){const s="GameDataCreate";let t="";if(enginesis.authTokenWasValidated&&0!=Math.floor(enginesis.loggedInUserInfo.user_id)||!isEmpty(e.from_address)&&!isEmpty(e.from_name)?isEmpty(enginesis.gameId)&&(t="INVALID_GAME_ID"):t="INVALID_PARAMETER",""==t){const t={from_address:e.from_address||"",from_name:e.from_name||"",to_address:e.to_address||"",to_name:e.to_name||"User",user_msg:e.user_message||"",user_files:"",game_data:safeData(e.game_data)||"",name_tag:e.name_tag||"",add_to_gallery:e.add_to_gallery||0,last_score:e.last_score||0};return e.game_image?new Promise(function(i){_requestFileUpload("gameshare","game_image.png",e.game_image).then(function(e){e.status&&"1"==e.status.success&&(t.user_files=e.results.path+e.results.file),sendRequest(s,t,n).then(function(e){i(e)})},function(e){debugLog("SendToFriend error "+e.toString()+" while uploading image, continuing anyway."),sendRequest(s,t,n).then(function(e){i(e)})}).catch(function(e){debugLog("SendToFriend exception "+e.toString()+" while uploading image, continuing anyway."),sendRequest(s,t,n).then(function(e){i(e)})})}):sendRequest(s,t,n)}return immediateErrorResponse(s,{game_id:enginesis.gameId,from_address:e.from_address,from_name:e.from_name},t,"Error "+t+" encountered while processing send to friend.",n)},gameConfigGet:function(e,n,s,t,i){return void 0===e&&(e=0),void 0!==n&&0!=n||(n=enginesisContext.gameIdGet()),isEmpty(t)&&(t=enginesisContext.getDateNow()),void 0===s&&(s=1),sendRequest("GameConfigGet",{game_config_id:e,game_id:n,category:s,air_date:t},i)},gameTrackingRecord:function(e,n,s,t,i){if(enginesis.isBrowserBuild){const i=enginesisContext.gameIdGet().toString();try{isNull(n)&&(n=i),isNull(s)&&(s=""),t=isNull(t)?"":t.substring(0,255),enginesis.isBrowserBuild&&(null!=window.dataLayer?window.dataLayer.push({event:e,gameid:i,action:n,label:s,value:t}):null!=window.ga&&window.ga("send","event",e,n,s,t))}catch(e){debugLog("Analytics exception "+e.toString())}}return sendRequest("GameTrackingRecord",{hit_type:"game_event",hit_category:e,hit_action:n,hit_label:s,hit_data:t},i)},gameFind:function(e,n){return sendRequest("GameFind",{game_name_part:e},n)},gameFindByName:function(e,n){return sendRequest("GameFindByName",{game_name:e},n)},gameGet:function(e,n){return sendRequest("GameGet",{game_id:e},n)},gameGetByName:function(e,n){return sendRequest("GameGetByName",{game_name:e},n)},gameListByCategory:function(e,n,s){return sendRequest("GameListByCategory",{num_items_per_category:e,game_status_id:n},s)},gameListList:function(e){return sendRequest("GameListList",{},e)},gameListListGames:function(e,n){return sendRequest("GameListListGames",{game_list_id:e},n)},gameListListGamesByName:function(e,n){return sendRequest("GameListListGamesByName",{game_list_name:e},n)},gameListByMostPopular:function(e,n,s,t,i){return sendRequest("GameListByMostPopular",{start_date:e,end_date:n,start_item:s,num_items:t},i)},gameListByIdList:function(e,n,s){return sendRequest("GameListByIdList",{game_id_list:e,delimiter:n},s)},gameListCategoryList:function(e){return sendRequest("GameListCategoryList",{},e)},gameListListRecommendedGames:function(e,n){return sendRequest("GameListListRecommendedGames",{game_list_id:e},n)},gamePlayEventListByMostPlayed:function(e,n,s,t){return sendRequest("GamePlayEventListByMostPlayed",{start_date:e,end_date:n,num_items:s},t)},gameRatingGet:function(e,n){return sendRequest("GameRatingGet",{game_id:e},n)},gameRatingList:function(e,n,s){return sendRequest("GameRatingList",{game_id:e,num_items:n},s)},gameRatingUpdate:function(e,n,s){return sendRequest("GameRatingUpdate",{game_id:e,rating:n},s)},scoreSubmitUnauth:function(e,n,s,t,i,r,o){return sendRequest("ScoreSubmitUnauth",{game_id:e,session_id:enginesis.sessionId,user_name:n,score:s,game_data:safeData(t),time_played:i,user_source:r},o)},decryptServerPayload:function(e){return new Promise(function(n,s){const t=enginesis.sessionId;decryptString(base64URLDecode(e),t).then(function(e){e?n(e):s(new Error("Not able to decrypt payload from service, verify your session agrees with the server."))}).catch(function(e){s(e)})})},scoreSubmit:function(e,n,s,t,i,r){return new Promise(function(o){const a="ScoreSubmit",u=enginesis.sessionId;let c="";function d(u,c){callbackPriority(forceErrorResponseObject(a,0,u,c,{game_id:e,level_id:s,score:n,game_data:t,time_played:i}),o,r,enginesis.callBackFunction)}enginesis.authTokenWasValidated&&0!=Math.floor(enginesis.loggedInUserInfo.user_id)?null==u?c="INVALID_SESSION":isEmpty(e)&&isEmpty(e=enginesis.gameId)&&(c="INVALID_GAME_ID"):c="NOT_LOGGED_IN",""==c?encryptScoreSubmit(enginesis.siteId,enginesis.loggedInUserInfo.user_id,e,s,n,t,i,u).then(function(e){e?sendRequest(a,{data:base64URLEncode(e)},r).then(function(e){o(e)}).catch(function(e){d("SYSTEM_ERROR","Exception encountered while exchanging score with server: "+e.toString())}):d("SYSTEM_ERROR","System error encountered while processing score submit.")}).catch(function(e){d("INVALID_PARAMETER","Exception encountered while processing score submit: "+e.toString())}):d(c,"Error encountered while processing score submit.")})},scoreRankList:function(e,n,s,t,i,r,o){isEmpty(e)&&(e=enginesis.gameId),isEmpty(s)&&(s=0),isEmpty(t)&&(t=0),isEmpty(i)&&(i=1),isEmpty(r)&&(r=100);return sendRequest("ScoreRankList",{game_id:e,level_id:n,time_period_type:s,time_period:t,start_rank:i,num_ranks:r},o)},newsletterCategoryList:function(e){return sendRequest("NewsletterCategoryList",{},e)},newsletterAddressAssign:function(e,n,s,t,i){return sendRequest("NewsletterAddressAssign",{email_address:e,user_name:n,company_name:s,categories:t,delimiter:","},i)},newsletterAddressUpdate:function(e,n,s,t,i,r){return sendRequest("NewsletterAddressUpdate",{newsletter_address_id:e,email_address:n,user_name:s,company_name:t,active:i},r)},newsletterAddressDelete:function(e,n){return sendRequest("NewsletterAddressDelete",{email_address:e,newsletter_address_id:"NULL"},n)},newsletterAddressGet:function(e,n){return sendRequest("NewsletterAddressGet",{email_address:e},n)},promotionItemList:function(e,n,s){return sendRequest("PromotionItemList",{promotion_id:e,query_date:n},s)},promotionList:function(e,n,s,t){return sendRequest("PromotionItemList",{promotion_id:e,query_date:n,show_items:s},t)},recommendedGameList:function(e,n){return sendRequest("RecommendedGameList",{game_id:e},n)},registeredUserCreate:function(e,n,s,t,i,r,o,a,u,c,d,g,l,f,m,V,h,p,y,A,v,R,S,I,_){return sendRequest("RegisteredUserCreate",{site_id:enginesis.siteId,user_name:e,real_name:t,dob:i,gender:r,email_address:s,city:o,state:a,zipcode:u,country_code:c,mobile_number:d,im_id:g,img_url:y,about_me:A,tagline:l,additional_info:v,site_user_id:f,network_id:m,agreement:V,password:n,security_question_id:h,security_answer:p,source_site_id:R,captcha_id:isEmpty(S)?enginesis.captchaId:S,captcha_response:isEmpty(I)?enginesis.captchaResponse:I},_)},registeredUserUpdate:function(e,n,s,t,i,r,o,a,u,c,d,g,l,f,m,V,h,p){return sendRequest("RegisteredUserUpdate",{site_id:enginesis.siteId,user_id:enginesis.userId,user_name:e,real_name:s,dob:t,gender:i,email_address:n,city:r,state:o,zipcode:a,country_code:u,mobile_number:c,im_id:d,img_url:l,about_me:f,tagline:g,additional_info:m,captcha_id:isEmpty(V)?enginesis.captchaId:V,captcha_response:isEmpty(h)?enginesis.captchaResponse:h},p)},registeredUserSecurityUpdate:function(e,n,s,t,i,r){return sendRequest("RegisteredUserSecurityUpdate",{site_id:enginesis.siteId,captcha_id:isEmpty(e)?enginesis.captchaId:e,captcha_response:isEmpty(n)?enginesis.captchaResponse:n,security_question_id:s,security_question:t,security_answer:i},r)},registeredUserConfirm:function(e,n,s){return sendRequest("RegisteredUserConfirm",{user_id:e,secondary_password:n},s)},registeredUserForgotPassword:function(e,n,s){return sendRequest("RegisteredUserForgotPassword",{user_name:e,email:n},s)},registeredUserResetSecondaryPassword:function(e,n,s,t,i){return sendRequest("RegisteredUserResetSecondaryPassword",{user_id:e,user_name:n,email_address:s,secondary_password:t},i)},registeredUserRequestPasswordChange:function(e){return sendRequest("RegisteredUserRequestPasswordChange",{site_id:enginesis.siteId},e)},registeredUserPasswordChange:function(e,n,s,t,i){return sendRequest("RegisteredUserPasswordChange",{site_id:enginesis.siteId,captcha_id:isEmpty(e)?enginesis.captchaId:e,captcha_response:isEmpty(n)?enginesis.captchaResponse:n,password:s,secondary_password:t},i)},registeredUserSecurityGet:function(e){return sendRequest("RegisteredUserSecurityGet",{site_id:enginesis.siteId,site_user_id:""},e)},registeredUserGet:function(e,n,s,t){return sendRequest("RegisteredUserGet",{get_user_id:e,site_user_id:n,network_id:s},t)},siteListGames:function(e,n,s,t){return(null==e||e<0)&&(e=1),(null==n||n>500)&&(n=500),(null==s||s>3)&&(s=2),sendRequest("SiteListGames",{start_item:e,num_items:n,game_status_id:s},t)},siteListGamesRandom:function(e,n){return(null==e||e>500)&&(e=500),sendRequest("SiteListGamesRandom",{num_items:e},n)},userGetByName:function(e,n){return sendRequest("UserGetByName",{user_name:e},n)},userGetByEmail:function(e,n){return sendRequest("UserGetByEmail",{email_address:e},n)},userLogout:function(e){return sendRequest("UserLogout",{},e)},userLogin:function(e,n,s){return sendRequest("UserLogin",{user_name:e,password:n},s)},userLoginCoreg:function(e,n,s){return void 0!==e.siteUserId&&0!=e.siteUserId.length&&((void 0!==e.userName&&0!=e.userName.length||void 0!==e.realName&&0!=e.realName.length)&&(void 0===e.userName&&(e.userName=""),void 0===e.realName&&(e.realName=""),(void 0===e.gender||0==e.gender.length||"M"!=e.gender&&"F"!=e.gender&&"U"!=e.gender)&&(e.gender="U"),void 0===e.emailAddress&&(e.emailAddress=""),void 0===e.scope&&(e.scope=""),void 0===e.agreement&&(e.agreement="0"),void 0===e.idToken&&(e.idToken=""),void 0===e.avatarURL&&(e.avatarURL=""),void 0===e.dob||0==e.dob.length?(e.dob=new Date,e.dob=e.dob.toISOString().slice(0,9)):e.dob instanceof Date&&(e.dob=e.dob.toISOString().slice(0,9)),sendRequest("UserLoginCoreg",{site_user_id:e.siteUserId,user_name:e.userName,real_name:e.realName,email_address:e.emailAddress,gender:e.gender,dob:e.dob,network_id:n,scope:e.scope,agreement:e.agreement,avatar_url:e.avatarURL,id_token:e.idToken},s)))},avatarURL:function(e,n){return 0==n&&(n=enginesis.loggedInUserInfo?enginesis.loggedInUserInfo.user_id:0),e<0?e=0:e>2&&(e=2),enginesis.siteResources.avatarImageURL+"?site_id="+enginesis.siteId+"&user_id="+n+"&size="+e},quizGet:function(e,n){return sendRequest("QuizGet",{game_id:e},n)},quizPlay:function(e,n,s){return sendRequest("QuizPlay",{game_id:e,game_group_id:n},s)},quizPlayScheduled:function(e,n,s){return sendRequest("QuizPlayScheduled",{game_id:e,game_group_id:n},s)},quizOutcomesCountList:function(e,n,s){return sendRequest("QuizOutcomesCountList",{game_id:e,game_group_id:n},s)},quizSubmit:function(e,n,s){return sendRequest("QuizSubmit",{game_id:e,results:n},s)},quizQuestionPlayed:function(e,n,s,t){return sendRequest("QuizQuestionPlayed",{game_id:e,question_id:n,choice_id:s},t)},isUserFavoriteGame:function(e,n){const s=parseInt(e,10)||enginesis.gameId,t=enginesis.favoriteGames.has(s);return"function"==typeof n&&enginesis.favoriteGamesNextCheck<Date.now()&&enginesisContext.userFavoriteGamesList().then(function(e){n(s,enginesis.favoriteGames.has(s))}),t},userFavoriteGamesList:function(e){return enginesis.favoriteGamesNextCheck=Date.now()+6e4,sendRequest("UserFavoriteGamesList",{},e)},userFavoriteGamesAssign:function(e,n){const s="UserFavoriteGamesAssign",t=e||enginesis.gameId,i={game_id:t};if(enginesis.favoriteGames.add(t),enginesis.isUserLoggedIn)return sendRequest(s,i,n);{const e="NOT_AUTHENTICATED",t="You must log in to update your favorite games.";return anonymousUserSave(),immediateErrorResponse(s,i,e,t,n)}},userFavoriteGamesAssignList:function(e,n){const s=e.split(",");for(let e=0;e<s.length;e+=1)enginesis.favoriteGames.add(s[e]);const t="UserFavoriteGamesAssignList",i={game_id_list:e,delimiter:","};if(enginesis.isUserLoggedIn)return sendRequest(t,i,n);{const e="NOT_AUTHENTICATED",s="You must log in to update your favorite games.";return anonymousUserSave(),immediateErrorResponse(t,i,e,s,n)}},userFavoriteGamesUnassign:function(e,n){const s=e||enginesis.gameId,t="UserFavoriteGamesUnassign",i={game_id:s};if(enginesis.favoriteGames.delete(s),enginesis.isUserLoggedIn)return sendRequest(t,i,n);{const e="NOT_AUTHENTICATED",s="You must log in to update your favorite games.";return anonymousUserSave(),immediateErrorResponse(t,i,e,s,n)}},userFavoriteGamesUnassignList:function(e,n){const s=e.split(",");for(let e=0;e<s.length;e+=1)enginesis.favoriteGames.delete(s[e]);const t="UserFavoriteGamesUnassignList",i={game_id_list:e,delimiter:","};if(enginesis.isUserLoggedIn)return sendRequest(t,i,n);{const e="NOT_AUTHENTICATED",s="You must log in to update your favorite games.";return anonymousUserSave(),immediateErrorResponse(t,i,e,s,n)}},userFavoriteGamesMove:function(e,n,s){return sendRequest("UserFavoriteGamesMove",{game_id:e,sort_order:n},s)},anonymousUserSetDateLastVisit:function(){null==enginesis.anonymousUser&&anonymousUserLoad(),enginesis.anonymousUser.dateLastVisit=new Date},anonymousUserSetSubscriberEmail:function(e,n){null==enginesis.anonymousUser&&anonymousUserLoad(),void 0===n&&(n=!0);const s=enginesis.anonymousUser.subscriberEmail;(n&&e!=s||!n&&isEmpty(s))&&(enginesis.anonymousUser.subscriberEmail=e,anonymousUserSave())},anonymousUserGetSubscriberEmail:function(){return null==enginesis.anonymousUser&&anonymousUserLoad(),enginesis.anonymousUser.subscriberEmail},anonymousUserSetUserName:function(e,n){null==enginesis.anonymousUser&&anonymousUserLoad(),void 0===n&&(n=!0);const s=enginesis.anonymousUser.userName;(n&&e!=s||!n&&isEmpty(s))&&(enginesis.anonymousUser.userName=e,anonymousUserSave())},anonymousUserGetUserName:function(){return null==enginesis.anonymousUser&&anonymousUserLoad(),enginesis.anonymousUser.userName},anonymousUserSetId:function(e){null==enginesis.anonymousUser&&anonymousUserLoad(),(void 0===enginesis.anonymousUser.userId||enginesis.anonymousUser.userId<1e4)&&(enginesis.anonymousUser.userId=e,anonymousUserSave())},anonymousUserGetId:function(){return null==enginesis.anonymousUser&&anonymousUserLoad(),enginesis.anonymousUser.userId||0},anonymousUserAddFavoriteGame:function(e){null==enginesis.anonymousUser&&anonymousUserLoad(),enginesis.anonymousUser.favoriteGames.add(e),anonymousUserSave()},anonymousUserGamePlayed:function(e){null==enginesis.anonymousUser&&anonymousUserLoad(),enginesis.anonymousUser.gamesPlayed.add(e),anonymousUserSave()},conferenceAssetRootPath:function(e){return"https://"+enginesis.serverHost+"/sites/"+enginesis.siteId+"/conf/"+e+"/"},conferenceGet:function(e,n){let s;return parseInt(e,10)>0?s="":(s=e,e=0),sendRequest("ConferenceGet",{conference_id:e,visible_id:s},n)},conferenceTopicGet:function(e,n,s){let t;return parseInt(e,10)>0?t="":(t=e,e=0),sendRequest("ConferenceTopicGet",{conference_id:e,visible_id:t,conference_topic_id:n},s)},conferenceTopicList:function(e,n,s,t,i,r,o){let a;return parseInt(e,10)>0?a="":(a=e,e=0),sendRequest("ConferenceTopicList",{conference_id:e,visible_id:a,tags:n,start_date:s,end_date:t,start_item:i,num_items:r},o)},_private:{sessionValidateHash:sessionVerifyHash,sessionMakeHash:sessionMakeHash}};